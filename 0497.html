Subject:
Пьяная ханойская башня

Body:
<div class="problem_content">

<p>Боб очень хорошо знаком с известной математической игрой/головоломкой "ханойская башня". Она состоит из трех вертикальных штырей и дисков разных размеров, которые можно надевать на штыри. Игра начинается со стопки из <var>n</var> дисков, размещенной на самом левом штыре в порядке уменьшения размера диска снизу вверх. Цель игры - переместить все диски с левого штыря на правый при следующих ограничениях:</p>

<ol>
<li>Только один диск может быть перемещен за ход.</li>
<li>Ход состоит в снятии самого верхнего диска со штыря и помещении его на верх другой стопки дисков или на пустой штырь.</li>
<li>Нельзя помещать диск на диск меньшего размера.</li>
</ol>

<p>В "пьяном" варианте этой игры рассмотрим длинную комнату длиной в <var>k</var> единиц (квадратных плиток). Каждый квадрат пронумерован от 1 до <var>k</var> в возрастающем порядке. В квадратах с номерами <var>a</var>, <var>b</var> и <var>c</var> расположены три штыря. На штыре в квадрате <var>a</var> находится стопка из <var>n</var> дисков.</p>

<p>Боб начинает игру стоя в квадрате <var>b</var>. Его цель - решить ханойскую башню переместив все диски на штырь в квадрате <var>c</var>. Однако, Боб может взять диск со штыря или положить его на штырь только когда он находится в одном квадрате с этим штырем.</p>

<p>К несчастью, Боб еще и пьян. В каждый свой ход Боб с одинаковой вероятностью может перейти направо или налево в соседний квадрат, кроме случаев, когда Боб находится в одном из концов комнаты. Тогда он может двигаться только в одном направлении. Несмотря на то, что Боб в подпитии, он по-прежнему способен следовать правилам игры и выбирать, когда взять или положить диск на штырь.</p>

<p>Следующая анимация показывает вид сбоку на пример такой игры для <var>n</var> = 3, <var>k</var> = 7, <var>a</var> = 2, <var>b</var> = 4 и <var>c</var> = 6:</p>

<p align="center"><img src="https://projecteuler.net/project/images/p497_hanoi.gif"></p>

<p>Пусть E(<var>n</var>,<var>k</var>,<var>a</var>,<var>b</var>,<var>c</var>) будет ожидаемым количеством квадратов, которые Боб пройдет в течение одной оптимально сыгранной игры. Игра считается сыгранной оптимально при минимальном возможном количестве взятий дисков.</p>

<p>Любопытно, что результат всегда будет целым числом. Например, E(2,5,1,3,5) = 60 и E(3,20,4,9,17) = 2358.</p>

<p>Найдите последние девять цифр числа &sum;<sub>1&le;<var>n</var>&le;10000</sub> E(<var>n</var>,10<sup><var>n</var></sup>,3<sup><var>n</var></sup>,6<sup><var>n</var></sup>,9<sup><var>n</var></sup>).</p>
</div>