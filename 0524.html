Subject:
Первая сортировка II

Body:
<div class="problem_content">

<p>Рассмотрим следующий алгоритм сортировки списка чисел по возрастанию:</p>
<ul style="list-style-type:none;">
<li>1. Последовательно проверить каждую пару соседних элементов, начиная с первых двух.</li>
<li>2. Если элементы пары расположены в неправильном порядке:
<ul style="list-style-type:none;">
<li>a. Переместить меньший элемент пары в начало списка.</li>
<li>b. Начать снова с шага 1.</li>
</ul></li>
<li>3. Если все пары имеют правильный порядок, остановиться.</li>
</ul>
<p>Например, список { 4 1 3 2 } будет отсортирован следующим образом:</p>
<ul style="list-style-type:none;">
<li><u>4 1</u> 3 2  (4 и 1 в неправильном порядке, 1 перемещается в начало списка)</li>
<li>1 <u>4 3</u> 2  (4 и 3 в неправильном порядке, 3 перемещается в начало списка)</li>
<li><u>3 1</u> 4 2  (3 и 1 в неправильном порядке, 1 перемещается в начало списка)</li>
<li>1 3 <u>4 2</u>  (4 и 2 в неправильном порядке, 2 перемещается в начало списка)</li>
<li><u>2 1</u> 3 4  (2 и 1 в неправильном порядке, 1 перемещается в начало списка)</li>
<li>1 2 3 4  (список отсортирован)</li>
</ul>
<p>Пусть <var>F</var>(<var>L</var>) будет количеством исполнений шага 2a в процессе сортировки списка <var>L</var>. Например, <var>F</var>({ 4 1 3 2 }) = 5.</p>

<p>Мы можем перечислить все перестановки <var>P</var> целых чисел {1, 2, ..., <var>n</var>} в <b>лексикографическом порядке</b> и присвоить каждой перестановке индекс <var>I</var><sub><var>n</var></sub>(<var>P</var>) от 1 до <var>n</var>!, соответствующий ее положению в получившемся списке.

</p><p>Пусть <var>Q</var>(<var>n</var>, <var>k</var>) = min(<var>I</var><sub><var>n</var></sub>(<var>P</var>)) для <var>F</var>(<var>P</var>) = <var>k</var> будет индексом первой перестановки, требующей ровно <var>k</var> шагов для сортировки списка алгоритмом "первая сортировка". Если не существует такой перестановки, для которой <var>F</var>(<var>P</var>) = <var>k</var>, то значение <var>Q</var>(<var>n</var>, <var>k</var>) не определено.</p>

<p>Для <var>n</var> = 4 имеем:</p>

<p></p>
<table border="1" style="text-align:left;">
<tr><th><var>P</var></th><th><var>I</var><sub>4</sub>(<var>P</var>)</th><th><var>F</var>(<var>P</var>)</th><th></th></tr><tr><td>{1, 2, 3, 4}</td><td>1</td><td>0</td><td>Q(4, 0) = 1</td></tr><tr><td>{1, 2, 4, 3}</td><td>2</td><td>4</td><td>Q(4, 4) = 2</td></tr><tr><td>{1, 3, 2, 4}</td><td>3</td><td>2</td><td>Q(4, 2) = 3</td></tr><tr><td>{1, 3, 4, 2}</td><td>4</td><td>2</td><td></td></tr><tr><td>{1, 4, 2, 3}</td><td>5</td><td>6</td><td>Q(4, 6) = 5</td></tr><tr><td>{1, 4, 3, 2}</td><td>6</td><td>4</td><td></td></tr><tr><td>{2, 1, 3, 4}</td><td>7</td><td>1</td><td>Q(4, 1) = 7</td></tr><tr><td>{2, 1, 4, 3}</td><td>8</td><td>5</td><td>Q(4, 5) = 8</td></tr><tr><td>{2, 3, 1, 4}</td><td>9</td><td>1</td><td></td></tr><tr><td>{2, 3, 4, 1}</td><td>10</td><td>1</td><td></td></tr><tr><td>{2, 4, 1, 3}</td><td>11</td><td>5</td><td></td></tr><tr><td>{2, 4, 3, 1}</td><td>12</td><td>3</td><td>Q(4, 3) = 12</td></tr><tr><td>{3, 1, 2, 4}</td><td>13</td><td>3</td><td></td></tr><tr><td>{3, 1, 4, 2}</td><td>14</td><td>3</td><td></td></tr><tr><td>{3, 2, 1, 4}</td><td>15</td><td>2</td><td></td></tr><tr><td>{3, 2, 4, 1}</td><td>16</td><td>2</td><td></td></tr><tr><td>{3, 4, 1, 2}</td><td>17</td><td>3</td><td></td></tr><tr><td>{3, 4, 2, 1}</td><td>18</td><td>2</td><td></td></tr><tr><td>{4, 1, 2, 3}</td><td>19</td><td>7</td><td>Q(4, 7) = 19</td></tr><tr><td>{4, 1, 3, 2}</td><td>20</td><td>5</td><td></td></tr><tr><td>{4, 2, 1, 3}</td><td>21</td><td>6</td><td></td></tr><tr><td>{4, 2, 3, 1}</td><td>22</td><td>4</td><td></td></tr><tr><td>{4, 3, 1, 2}</td><td>23</td><td>4</td><td></td></tr><tr><td>{4, 3, 2, 1}</td><td>24</td><td>3</td><td></td></tr>
</table>
<p>Пусть <var>R</var>(<var>k</var>) = min(<var>Q</var>(<var>n</var>, <var>k</var>)) для всех <var>n</var>, для которых значение <var>Q</var>(<var>n</var>, <var>k</var>) определено.</p>

<p>Найдите <var>R</var>(12<sup>12</sup>).</p>

</div>